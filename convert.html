<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>FreeComfortLab – 파일 변환 실험실</title>
  <meta name="description" content="파일 변환 실험 페이지 (UI 테스트 단계)" />

  <style>
    body {
      margin: 0;
      padding: 0;
      background: #0e1016;
      font-family: 'Pretendard', sans-serif;
      color: #fff;
    }
    a { text-decoration: none; color: #9aa4c6; }

    .page-wrapper {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .card {
      background: #1b1f27;
      border-radius: 12px;
      padding: 24px;
      border: 1px solid #2a2f3a;
    }

    h1 {
      font-size: 28px;
      margin-bottom: 4px;
      font-weight: 700;
    }

    .sub-text {
      font-size: 14px;
      color: #9aa4c6;
      margin-bottom: 28px;
    }

    .btn-back {
      display: inline-block;
      margin-bottom: 20px;
      padding: 6px 12px;
      border-radius: 8px;
      background: #2a2f3a;
      font-size: 14px;
    }

    .label {
      font-size: 14px;
      margin-bottom: 6px;
      display: block;
    }

    input, select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #3a3f4a;
      background: #12141a;
      color: #fff;
      margin-bottom: 20px;
    }

    button {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: none;
      background: #4f8cff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
    }

    button:disabled {
      background: #3c4b6b;
      cursor: not-allowed;
    }

    .hint {
      font-size: 13px;
      color: #8c94a6;
      margin-top: 20px;
      line-height: 1.6;
    }
  </style>
</head>

<body>
  <div class="page-wrapper">
    <a href="/" class="btn-back">← 메인으로 돌아가기</a>

    <h1>파일 변환 실험실</h1>
    <div class="sub-text">
      1차 버전 – UI 배치 상태. Flask 변환 서버와 연결된 실험 페이지입니다. 현재는 <b>mp3 변환만 지원</b>합니다.
    </div>

    <div class="card">
      <div class="label">파일 업로드 & 포맷 선택</div>
      <div class="hint">
        아래 UI는 Flask 변환 서버 + Cloudflare Worker를 통해 mp3로 변환됩니다.<br />
        지금은 “요청하기” 단계이며, 변환 자체는 mp3만 지원하는 상태입니다.
      </div>

      <form>
        <label class="label">1. 파일 선택</label>
        <input type="file" name="input_file" />

        <label class="label">2. 변환 포맷</label>
        <select name="format">
          <option value="mp3">mp3로 변환 (현재 지원)</option>
          <option value="original" disabled>원본 유지 (준비 중)</option>
          <option value="mp4" disabled>mp4로 변환 (준비 중)</option>
          <option value="wav" disabled>wav로 변환 (준비 중)</option>
        </select>

        <button type="submit">변환 요청</button>
      </form>

      <div class="hint">
        지금 단계는 1차 스케치 단계입니다.<br />
        추후 mp4, wav 등 다른 포맷도 FFmpeg로 확장할 예정입니다.
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.querySelector("form");
      const fileInput = document.querySelector('input[type="file"]');
      const formatSelect = document.querySelector("select");
      const submitButton = document.querySelector('button[type="submit"]');

      let resultBox = document.getElementById("convert-result-box");
      if (!resultBox) {
        resultBox = document.createElement("div");
        resultBox.id = "convert-result-box";
        resultBox.style.marginTop = "20px";
        resultBox.style.fontSize = "14px";
        resultBox.style.color = "#8c94a6";
        form.parentNode.appendChild(resultBox);
      }

      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        if (!fileInput.files.length) {
          resultBox.textContent = "먼저 업로드할 파일을 선택하세요.";
          return;
        }

        const file = fileInput.files[0];
        const format = formatSelect.value;  // mp3 고정 (UI 기준)

        submitButton.disabled = true;
        submitButton.textContent = "변환 요청 중…";

        const formData = new FormData();
        formData.append("file", file);
        formData.append("format", format);

        try {
          const response = await fetch("/api/convert", {
            method: "POST",
            body: formData,
          });

          const data = await response.json();
          resultBox.textContent = "서버 응답: " + JSON.stringify(data, null, 2);
        } catch (err) {
          resultBox.textContent = "요청 오류: " + err.message;
        } finally {
          submitButton.disabled = false;
          submitButton.textContent = "변환 요청";
        }
      });
    });
  </script>
</body>
</html>
